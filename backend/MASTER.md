# Master服务概述

## 1. 服务架构

Master服务是一个基于Go语言开发的后端服务，采用了分层架构设计：

- **API层**：处理HTTP请求，包含路由定义和请求处理
- **服务层**：实现核心业务逻辑
- **数据访问层**：负责与数据库交互
- **领域模型**：定义业务实体和数据结构

## 2. 目录结构

```
d:\毕设\GDesign\backend\master
├── cmd/             # 程序入口
├── configs/         # 配置文件和配置管理
├── internal/        # 内部实现
│   ├── api/         # API层
│   ├── domain/      # 领域模型
│   ├── metrics/     # 监控指标
│   ├── middleware/  # 中间件
│   ├── repository/  # 数据访问层
│   └── service/     # 业务逻辑层
├── knowledge/       # 知识库相关
├── logs/            # 日志相关
├── migrations/      # 数据库迁移
├── pkg/             # 公共包
└── test/            # 测试文件
```

## 3. 核心功能模块

### 3.1 文法处理模块
提供文法相关的各种操作：
- 文法校验
- 文法类型判断
- 文法化简（去无用符号、单一产生式、空产生式）
- 二义性判断
- 等价性检查
- 字符串识别
- 示例字符串生成
- First集和Follow集计算

### 3.2 自动机处理模块
提供自动机相关功能：
- 自动机验证
- 字符串识别
- 自动机清理
- DFA最小化
- NFA确定化
- 等价性检查
- 示例字符串生成

### 3.3 正则表达式模块
提供正则表达式相关功能：
- 正则表达式验证
- 字符串识别
- 等价性检查
- 示例字符串生成

### 3.4 转换模块
提供不同形式之间的转换：
- 文法转NFA
- FA转文法
- 正则表达式转NFA
- FA转正则表达式

### 3.5 学习资源管理（暂未与前端对接，后期不一定采用）
管理学习资料：
- 获取学习资源列表
- 获取单个资源详情
- 生成上传预签名URL
- 更新学习资源
- 删除学习资源

### 3.6 存储模块
提供持久化存储功能：
- 自动机存储和检索
- 文法存储和检索
- 正则表达式存储和检索

## 4. 技术栈

- **语言**：Go
- **Web框架**：Gin
- **数据库**：PostgreSQL (使用GORM)
- **认证**：JWT
- **消息队列**：Kafka
- **对象存储**：阿里云OSS
- **监控**：Prometheus
- **日志**：zlog (基于zap封装)

## 5. 配置管理

- 支持从YAML文件和环境变量加载配置
- 主要配置项包括：服务器配置、JWT配置、数据库配置、Kafka配置、OSS配置、日志配置等
- 提供配置同步到环境变量的功能

## 6. 中间件

- JWT认证中间件
- 限流中间件
- CORS中间件
- 请求ID中间件
- 监控指标中间件

## 7. 数据存储

- 使用PostgreSQL存储各种数据，包括自动机、文法、正则表达式和学习资源
- 实现了分页查询和去重逻辑
- 对自动机和文法内容进行哈希处理，避免重复存储

## 8. 服务特性

- 支持优雅关闭
- 集成性能分析工具(pprof)
- 支持请求追踪
- 完善的错误处理
- 安全性考虑（JWT认证、资源归属验证）